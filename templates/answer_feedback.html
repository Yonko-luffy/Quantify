{% extends "base.html" %}

{% block head %}
<title>Answer Feedback - {{ quiz.name }}</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/quiz.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/feedback.css') }}">
{% endblock %}

{% block body %}
<div class="page-content">
<div class="feedback-page-container">

    <div class="feedback-content-wrapper">
        <!-- Compact Progress Header -->
        <div class="compact-feedback-header">
            <div class="progress-info">
                <h2>{{ quiz.name }}</h2>
                <p>Question {{ question_number }} of {{ total_questions }}</p>
                <p class="progress-detail">{{ answered_count }} answered • {{ total_questions - answered_count }} remaining</p>
            </div>
            <div class="result-indicator {{ 'result-correct' if result.is_correct else 'result-incorrect' }}">
                {{ '✅' if result.is_correct else '❌' }}
                <span>{{ 'Correct!' if result.is_correct else 'Incorrect!' }}</span>
            </div>
        </div>
        
        <div class="quiz-card answer-details">
            <div class="question-text">
                {{ question.question_text }}
            </div>
            
            <div class="answers-review">
                {% for option in options_data %}
                    {% set is_user_selected = loop.index0 in result.selected_answers %}
                    {% set is_correct_answer = loop.index0 in question.correct_answers %}
                    
                    <div class="answer-option 
                        {% if is_correct_answer %}correct-answer{% endif %}
                        {% if is_user_selected and not is_correct_answer %}your-wrong-answer{% endif %}">
                        
                        {% if is_user_selected %}
                            <strong>Your Answer:</strong> {{ option.text if option.text is defined else option }}
                        {% elif is_correct_answer %}
                            <strong>Correct Answer:</strong> {{ option.text if option.text is defined else option }}
                        {% else %}
                            {{ option.text if option.text is defined else option }}
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
            
            {% if question.explanation and question.explanation.strip() %}
            <div class="explanation-section">
                <h3>Explanation</h3>
                <p class="explanation-text">{{ question.explanation }}</p>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="feedback-footer">
        <form action="{{ url_for('quiz.next_question', attempt_id=attempt.id) }}" method="post">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <button type="submit" class="quiz-btn continue-btn">
                    Next →
            </button>
        </form>
    </div>

</div>
{% endblock %}
